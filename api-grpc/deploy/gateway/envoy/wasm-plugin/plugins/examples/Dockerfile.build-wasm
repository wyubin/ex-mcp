FROM golang:1.24-alpine

# 安裝 build 所需工具
RUN apk add --no-cache make gcc musl-dev build-base git

WORKDIR /workspace

# 預設 CMD：初始化 module、整理依賴、編譯 wasm、刪除 go.mod 和 go.sum
CMD ["sh", "-c", "\
    go mod init main || true && \
    go mod tidy && \
    env GOOS=wasip1 GOARCH=wasm go build -buildmode=c-shared -o main.wasm main.go && \
    rm -f go.mod go.sum \
"]
